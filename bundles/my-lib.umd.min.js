!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("d3")):"function"==typeof define&&define.amd?define("my-lib",["exports","@angular/core","d3"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["my-lib"]={},t.ng.core,t.d3)}(this,(function(t,e,i){"use strict";var a=function(){};a.ɵfac=function(t){return new(t||a)},a.ɵprov=e.ɵɵdefineInjectable({token:a,factory:a.ɵfac,providedIn:"root"}),("undefined"==typeof ngDevMode||ngDevMode)&&e.ɵsetClassMetadata(a,[{type:e.Injectable,args:[{providedIn:"root"}]}],(function(){return[]}),null);Object.create;function s(t,e){var i="function"==typeof Symbol&&t[Symbol.iterator];if(!i)return t;var a,s,n=i.call(t),r=[];try{for(;(void 0===e||e-- >0)&&!(a=n.next()).done;)r.push(a.value)}catch(t){s={error:t}}finally{try{a&&!a.done&&(i=n.return)&&i.call(n)}finally{if(s)throw s.error}}return r}function n(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(s(arguments[e]));return t}Object.create;var r=["root"],o=["scroll"],l=["zone"];var h=function(){function t(t){this.renderer=t,this.width=900,this.height=200,this.data=[],this.domain=[0,0],this.range=[0,0],this.rangeChange=new e.EventEmitter,this.currentTime=0,this.currentTimeChange=new e.EventEmitter,this.title="Timeline : ",this.margin={top:20,right:20,bottom:30,left:50},this.dataZoom=[],this.idZoom=0,this.minTime=0,this.maxTime=0,this.lengthTime=0,this.svgWidth=0,this.svgHeight=0,this.scaleX=i.scaleTime(),this.scaleY=i.scaleLinear(),this.area=[],this.line=[],this.lastDatalength=0,this.modeToolTips="normal",this.currentTimeSelected=!1,this.scrollbarSelected=!1,this.lastPos=0}return t.prototype.ngOnInit=function(){var t=this;this.dataZoom=n(this.data),this.lastDatalength=this.dataZoom.length,this.data.forEach((function(e,i){i==t.data.length-1?t.title=t.title+e.label+".":t.title=t.title+e.label+", "}))},t.prototype.ngAfterViewInit=function(){var t=this;if(null!=this.timeline){var e=this.timeline.nativeElement.width.animVal.value,i=this.timeline.nativeElement.height.animVal.value;this.svgWidth=e-this.margin.left-this.margin.right,this.svgHeight=i-this.margin.top-this.margin.bottom}this.data.forEach((function(e,i){return t.buildStyleData(e,i)})),this.buildZoom(),this.buildEvent(),this.drawToolTips(),this.drawAxis(),this.drawLineAndPath(),this.drawLineCurrentTime(),this.drawScrollbar()},t.prototype.ngOnChanges=function(t){t.data&&!t.data.firstChange&&this.updateChart(),(t.data&&!t.data.firstChange&&0!=this.range[0]&&0!=this.range[1]||t.range&&!t.range.firstChange)&&(this.idZoom=Math.round(Math.log(this.lengthTime/(this.range[1]-this.range[0]))/Math.log(1.5)),this.range=this.controlRange(this.range[0],this.range[1]-this.range[0]),0!=this.data.length&&(this.updateDataZoom(this.range[0],this.range[1]),this.updateSvg(this.range[0],this.range[1]))),t.currentTime&&!t.currentTime.firstChange&&0!=this.data.length&&this.updateCurrentTime()},t.prototype.buildEvent=function(){var t=this;this.svg=i.select(this.timeline.nativeElement).append("g").attr("transform","translate("+this.margin.left+","+this.margin.top+")"),i.select(this.timeline.nativeElement).on("mousemove",(function(e){t.currentTimeSelected?t.moveCurrentTime(e):t.showInfo(e)})).on("mouseleave",(function(){t.currentTimeSelected=!1,t.hideInfo()})).on("wheel",(function(e){return t.activeZoom(e)})).on("mouseup",(function(){return t.currentTimeSelected=!1})).on("mouseover",(function(t){return t.preventDefault()}))},t.prototype.buildStyleData=function(t,e){var a=this;"area"!=t.style&&"both"!=t.style||("step"==t.interpolation?this.area[e]=i.area().x((function(t){return a.scaleX(t[0])})).y0(this.svgHeight).y1((function(t){return a.scaleY(t[1])})).curve(i.curveStepAfter):this.area[e]=i.area().x((function(t){return a.scaleX(t[0])})).y0(this.svgHeight).y1((function(t){return a.scaleY(t[1])}))),"line"!=t.style&&"both"!=t.style||("step"==t.interpolation?this.line[e]=i.line().x((function(t){return a.scaleX(t[0])})).y((function(t){return a.scaleY(t[1])})).curve(i.curveStepAfter):this.line[e]=i.line().x((function(t){return a.scaleX(t[0])})).y((function(t){return a.scaleY(t[1])}))),this.controlColor(t.color)||(t.color="black")},t.prototype.buildZoom=function(){this.minTime=this.scale(this.data,"xMin"),this.maxTime=this.scale(this.data,"xMax"),this.lengthTime=this.maxTime-this.minTime,this.idZoom=0},t.prototype.drawToolTips=function(){var t=this;this.tooltip=this.svg.append("g").attr("id","tooltip").style("display","none"),this.tooltip.append("circle").attr("fill","#CCE5F6").attr("r",10),this.tooltip.append("circle").attr("fill","#3498db").attr("stroke","#fff").attr("stroke-width","1.5px").attr("r",4);var e=this.dataZoom.length;"normal"==this.modeToolTips?(this.tooltip.append("polyline").attr("points","0,0 0,"+40*e+", 75,"+40*e+", 80,"+45*e+" 85,"+40*e+" 160,"+40*e+" 160,0 0,0").style("fill","#fafafa").style("stroke","#3498db").style("opacity","0.9").style("stroke-width","1").attr("transform","translate(-80, "+-50*e+")"),this.dataZoom.forEach((function(e,i){var a=t.tooltip.append("text").style("font-size","13px").style("font-family","Segoe UI").style("color",e.color).style("fill",e.color).attr("transform","translate(-80,"+-42*(i+1)+")");a.append("tspan").attr("dx","7").attr("dy","5").attr("id","tooltip-date1"+i),a.append("tspan").attr("dx","-90").attr("dy","15").attr("id","tooltip-date2"+i)}))):(this.tooltip.append("polyline").attr("points","0,"+(95+40*(e-1))+" , 0,55 , 75,55 , 80,50 , 85,55 , 160,55 , 160,"+(95+40*(e-1))+" 0,"+(95+40*(e-1))).style("fill","#fafafa").style("stroke","#3498db").style("opacity","0.9").style("stroke-width","1").attr("transform","translate(-80, -50)"),this.dataZoom.forEach((function(e,i){var a=t.tooltip.append("text").style("font-size","13px").style("font-family","Segoe UI").style("color",e.color).style("fill",e.color).attr("transform","translate(-80,"+-30*(i+1)+")");a.append("tspan").attr("dx","7").attr("dy",50+70*i).attr("id","tooltip-date1"+i),a.append("tspan").attr("dx","-80").attr("dy","20").attr("id","tooltip-date2"+i)})))},t.prototype.drawAxis=function(){this.scaleX.range([0,this.svgWidth]),this.scaleX.domain([this.minTime,this.maxTime]),this.scaleY=i.scaleLinear(),this.scaleY.range([this.svgHeight,0]),this.scaleY.domain(this.controlDomain()),this.svg.append("g").attr("transform","translate(0,"+this.svgHeight+")").attr("class","xAxis").call(i.axisBottom(this.scaleX)),this.discreteValue(this.data)?this.svg.append("g").attr("class","yAxis").call(i.axisLeft(this.scaleY).ticks(this.scale(this.data,"yMax"))):this.svg.append("g").attr("class","yAxis").call(i.axisLeft(this.scaleY))},t.prototype.drawLineAndPath=function(){var t=this;this.dataZoom.forEach((function(e,i){"area"!=e.style&&"both"!=e.style||t.svg.append("path").datum(t.dataZoom[i].values).attr("class","area"+i).attr("d",t.area[i]).attr("stroke-width",.1).attr("opacity",.3).style("fill",e.color).style("stroke",e.color).style("stroke-width","2px"),"line"!=e.style&&"both"!=e.style||t.svg.append("path").datum(e.values).attr("class","line"+i).attr("d",t.line[i]).style("fill","none").style("stroke",e.color).style("stroke-width","2px")}))},t.prototype.drawLineCurrentTime=function(){var t=this;if(0!=this.data.length){0==this.currentTime&&(this.currentTime=this.scale(this.data,"xMin"));var e=0;this.svg.append("path").datum([[this.currentTime,this.controlDomain()[0]],[this.currentTime,this.svgHeight]]).attr("class","currentTimeLine").attr("d",i.line().x((function(i){return e=t.scaleX(i[0])})).y((function(e){return t.scaleY(e[1])}))).style("fill","none").style("stroke","red").style("stroke-width","3px"),this.svg.append("circle").attr("class","currentTimeSelector").attr("cx",e).attr("cy",-13).attr("r",7).attr("fill","red").on("mousedown",(function(){t.currentTimeSelected=!0,t.hideInfo()}))}},t.prototype.drawScrollbar=function(){var t=this;this.zoneScrollbar.nativeElement.style.width=this.svgWidth+"px",this.zoneScrollbar.nativeElement.style.marginLeft=this.margin.left+"px",this.zoneScrollbar.nativeElement.style.height="20px",this.zoneScrollbar.nativeElement.style.backgroundColor="lightgrey",this.zoneScrollbar.nativeElement.style.borderRadius="10px",this.scrollbar.nativeElement.style.width=this.svgWidth+"px",this.scrollbar.nativeElement.style.height="20px",this.scrollbar.nativeElement.style.backgroundColor="grey",this.scrollbar.nativeElement.style.borderRadius="10px",this.renderer.listen(this.scrollbar.nativeElement,"mousedown",(function(e){return t.activeScrollbar(e)})),this.renderer.listen(this.zoneScrollbar.nativeElement,"mouseleave",(function(){return t.desactiveScrollbar()})),this.renderer.listen(this.zoneScrollbar.nativeElement,"mouseup",(function(){return t.desactiveScrollbar()})),this.renderer.listen(this.zoneScrollbar.nativeElement,"mousemove",(function(e){return t.updateRange(e)}))},t.prototype.updateChart=function(){var t=this;this.dataZoom=n(this.data),this.data.forEach((function(e,i){t.buildStyleData(e,i),"area"==e.style&&t.svg.selectAll(".line"+i).remove(),"line"==e.style&&t.svg.selectAll(".area"+i).remove(),t.title="Timeline : ",i==t.data.length-1?t.title=t.title+e.label+".":t.title=t.title+e.label+", "})),this.buildZoom(),this.scaleX.domain([this.minTime,this.maxTime]),this.scaleY.range([this.svgHeight,0]),this.controlDomain(),this.scaleY.domain(this.controlDomain()),this.discreteValue(this.data)?this.svg.selectAll(".yAxis").call(i.axisLeft(this.scaleY).ticks(this.scale(this.data,"yMax"))):this.svg.selectAll(".yAxis").call(i.axisLeft(this.scaleY)),this.svg.selectAll(".xAxis").call(i.axisBottom(this.scaleX)),this.svg.selectAll(".currentTimeLine").remove(),this.svg.selectAll(".currentTimeSelector").remove(),this.updateLine(),this.drawLineCurrentTime(),this.updateScrollbar(this.minTime,this.maxTime),this.updateToolTips();for(var e=this.dataZoom.length;e<this.lastDatalength;e++)this.svg.selectAll(".line"+e).remove(),this.svg.selectAll(".area"+e).remove();this.lastDatalength=this.dataZoom.length},t.prototype.updateSvg=function(t,e){this.scaleX.domain([t,e]),this.svg.selectAll(".xAxis").call(i.axisBottom(this.scaleX)),this.updateLine(),this.updateCurrentTime(),this.updateScrollbar(t,e)},t.prototype.updateLine=function(){var t,e,i=this;this.dataZoom.forEach((function(a,s){"area"!=a.style&&"both"!=a.style||(e=i.svg.selectAll(".area"+s).data([i.dataZoom[s].values])).enter().append("path").attr("class","area"+s).merge(e).attr("d",i.area[s]).attr("stroke-width",.1).attr("opacity",.3).style("fill",a.color).style("stroke",a.color).style("stroke-width","2px"),"line"!=a.style&&"both"!=a.style||(t=i.svg.selectAll(".line"+s).data([i.dataZoom[s].values])).enter().append("path").attr("class","line"+s).merge(t).attr("d",i.line[s]).style("fill","none").style("stroke",a.color).style("stroke-width","2px")}))},t.prototype.updateCurrentTime=function(){var t=this,e=this.svg.selectAll(".currentTimeLine").datum([[this.currentTime,this.controlDomain()[0]],[this.currentTime,this.svgHeight]]),a=0;e.enter().append("path").attr("class","currentTimeLine").merge(e).attr("d",i.line().x((function(e){return a=t.scaleX(e[0])})).y((function(e){return t.scaleY(e[1])}))).style("fill","none").style("stroke","red").style("stroke-width","3px"),this.currentTime>=this.scale(this.dataZoom,"xMin")&&this.currentTime<=this.scale(this.dataZoom,"xMax")?(this.svg.selectAll(".currentTimeLine").attr("display","block"),this.svg.selectAll(".currentTimeSelector").attr("display","block")):(this.svg.selectAll(".currentTimeLine").attr("display","none"),this.svg.selectAll(".currentTimeSelector").attr("display","none")),this.svg.selectAll(".currentTimeSelector").attr("cx",a)},t.prototype.updateScrollbar=function(t,e){this.scrollbar.nativeElement.style.marginLeft=this.svgWidth*(t-this.minTime)/this.lengthTime+"px",this.scrollbar.nativeElement.style.width=this.svgWidth*(e-t)/this.lengthTime+"px"},t.prototype.updateRange=function(t){if(this.scrollbarSelected){t.preventDefault();var e=this.range[1]-this.range[0],i=this.scale(this.dataZoom,"xMin"),a=t.clientX-this.margin.left;0==this.lastPos&&(this.lastPos=a);var s=(a-this.lastPos)*this.lengthTime/this.svgWidth+i;this.range=this.controlRange(s,e),this.updateDataZoom(this.range[0],this.range[1]),this.updateSvg(this.range[0],this.range[1]),this.rangeChange.emit(this.range),this.lastPos=a}},t.prototype.updateDataZoom=function(t,e){var a,s=this;this.data.forEach((function(i,a){s.dataZoom[a]={label:i.label,values:i.values.filter((function(i){return t<=i[0]&&i[0]<=e})),color:i.color,style:i.style,interpolation:i.interpolation}})),this.data.forEach((function(n,r){a=[],n.values.forEach((function(t){return a.push(t[0])}));var o=i.bisectLeft(a,t)-1;o>=0&&o<s.data[r].values.length&&s.dataZoom[r].values.unshift([t,s.data[r].values[o][1]]),s.dataZoom[r].values.push([e,s.dataZoom[r].values[s.dataZoom[r].values.length-1][1]])}))},t.prototype.updateToolTips=function(){this.tooltip.remove(),this.drawToolTips()},t.prototype.activeScrollbar=function(t){this.scrollbarSelected=!0,this.lastPos=t.clientX-this.margin.left},t.prototype.desactiveScrollbar=function(){this.scrollbarSelected=!1,this.lastPos=0},t.prototype.showInfo=function(t){var e=this,a=[];if(null!=this.dataZoom[0]){this.dataZoom[0].values.forEach((function(t){return a.push(t[0])})),this.tooltip.style("display","block"),this.tooltip.style("opacity",100);var s=this.scaleX.invert(t.clientX-this.margin.left).getTime(),n=i.bisectRight(a,s);n>this.dataZoom[0].values.length-1?n=this.dataZoom[0].values.length-1:n<0&&(n=0);var r=this.dataZoom[0].values[n][1],o=this.dataZoom[0].values[n][0];this.scaleY(r)<=40*this.dataZoom.length?"inverse"!=this.modeToolTips&&(this.modeToolTips="inverse",this.updateToolTips()):"normal"!=this.modeToolTips&&(this.modeToolTips="normal",this.updateToolTips()),this.dataZoom.forEach((function(t,a){var s=n;s>t.values.length-1?s=e.dataZoom[a].values.length-1:s<0&&(s=0);var r=t.values[s][1],o=t.values[s][0],l=new Date(o).toLocaleDateString("fr",{year:"numeric",month:"long",day:"numeric",hour:"numeric",minute:"numeric",second:"numeric"});i.selectAll("#tooltip-date1"+a).text(l),i.selectAll("#tooltip-date2"+a).text(e.roundDecimal(r,2))})),this.tooltip.attr("transform","translate("+this.scaleX(o)+","+this.scaleY(r)+")")}},t.prototype.hideInfo=function(){this.tooltip.style("display","none")},t.prototype.activeZoom=function(t){t.preventDefault();var e=this.lengthTime/Math.pow(1.5,this.idZoom),i=this.scale(this.dataZoom,"xMin");if(t.deltaY>0&&this.idZoom>0||t.deltaY<0){t.deltaY>0&&this.idZoom>0?this.idZoom--:t.deltaY<0&&this.idZoom++;var a=this.scaleX.invert(t.clientX-this.margin.left).getTime(),s=this.lengthTime/Math.pow(1.5,this.idZoom),n=s/e*(i-a)+a;this.range=this.controlRange(n,s),s>1e4?(this.updateDataZoom(this.range[0],this.range[1]),this.updateSvg(this.range[0],this.range[1]),this.rangeChange.emit(this.range)):this.idZoom--}},t.prototype.moveCurrentTime=function(t){t.preventDefault();var e=this.scaleX.invert(t.clientX-this.margin.left).getTime();e<this.scale(this.dataZoom,"xMin")?this.currentTime=this.scale(this.dataZoom,"xMin"):e>this.scale(this.dataZoom,"xMax")?this.currentTime=this.scale(this.dataZoom,"xMax"):this.currentTime=e,this.updateCurrentTime(),this.currentTimeChange.emit(this.currentTime)},t.prototype.controlRange=function(t,e){this.minTime>t&&(t=this.minTime);var i=t+e;return this.maxTime<i&&(t=(i=this.maxTime)-e),this.minTime>t&&(t=this.minTime),[t,i]},t.prototype.controlDomain=function(){return 0==this.domain[0]&&0==this.domain[1]||this.discreteValue(this.data)?[this.scale(this.data,"yMin"),this.scale(this.data,"yMax")]:this.domain},t.prototype.controlColor=function(t){var e=(new Option).style;return e.color=t,""!=e.color},t.prototype.scale=function(t,e){var i=0;return t.forEach((function(t,a){return t.values.forEach((function(t,s){"yMin"==e&&(0==s&&0==a||t[1]<i)||"yMax"==e&&(0==s&&0==a||t[1]>i)?i=t[1]:("xMin"==e&&(0==s&&0==a||t[0]<i)||"xMax"==e&&(0==s&&0==a||t[0]>i))&&(i=t[0])}))})),i},t.prototype.discreteValue=function(t){for(var e=0;e<t.length;e++)for(var i=0;i<t[e].values.length;i++)if(t[e].values[i][1]!=Math.round(t[e].values[i][1]))return!1;return!0},t.prototype.roundDecimal=function(t,e){var i=Math.pow(10,e);return Math.round(t*i)/i},t}();h.ɵfac=function(t){return new(t||h)(e.ɵɵdirectiveInject(e.Renderer2))},h.ɵcmp=e.ɵɵdefineComponent({type:h,selectors:[["lib-my-lib"]],viewQuery:function(t,i){if(1&t&&(e.ɵɵviewQuery(r,1),e.ɵɵviewQuery(o,1),e.ɵɵviewQuery(l,1)),2&t){var a=void 0;e.ɵɵqueryRefresh(a=e.ɵɵloadQuery())&&(i.timeline=a.first),e.ɵɵqueryRefresh(a=e.ɵɵloadQuery())&&(i.scrollbar=a.first),e.ɵɵqueryRefresh(a=e.ɵɵloadQuery())&&(i.zoneScrollbar=a.first)}},inputs:{width:"width",height:"height",data:"data",domain:"domain",range:"range",currentTime:"currentTime"},outputs:{rangeChange:"rangeChange",currentTimeChange:"currentTimeChange"},features:[e.ɵɵNgOnChangesFeature],decls:8,vars:3,consts:[["root",""],["zone",""],["scroll",""]],template:function(t,i){1&t&&(e.ɵɵelementStart(0,"h2"),e.ɵɵtext(1),e.ɵɵelementEnd(),e.ɵɵnamespaceSVG(),e.ɵɵelement(2,"svg",null,0),e.ɵɵnamespaceHTML(),e.ɵɵelementStart(4,"div",null,1),e.ɵɵelement(6,"div",null,2),e.ɵɵelementEnd()),2&t&&(e.ɵɵadvance(1),e.ɵɵtextInterpolate(i.title),e.ɵɵadvance(1),e.ɵɵattribute("width",i.width)("height",i.height))},encapsulation:2}),("undefined"==typeof ngDevMode||ngDevMode)&&e.ɵsetClassMetadata(h,[{type:e.Component,args:[{selector:"lib-my-lib",template:'\n  <h2>{{ title }}</h2>\n  <svg #root [attr.width]="width" [attr.height]="height"></svg>\n  <div #zone><div #scroll></div></div>\n  ',styles:[]}]}],(function(){return[{type:e.Renderer2}]}),{width:[{type:e.Input}],height:[{type:e.Input}],data:[{type:e.Input}],domain:[{type:e.Input}],timeline:[{type:e.ViewChild,args:["root"]}],scrollbar:[{type:e.ViewChild,args:["scroll"]}],zoneScrollbar:[{type:e.ViewChild,args:["zone"]}],range:[{type:e.Input}],rangeChange:[{type:e.Output}],currentTime:[{type:e.Input}],currentTimeChange:[{type:e.Output}]});var c=function(){};c.ɵfac=function(t){return new(t||c)},c.ɵmod=e.ɵɵdefineNgModule({type:c}),c.ɵinj=e.ɵɵdefineInjector({imports:[[]]}),("undefined"==typeof ngJitMode||ngJitMode)&&e.ɵɵsetNgModuleScope(c,{declarations:[h],exports:[h]}),("undefined"==typeof ngDevMode||ngDevMode)&&e.ɵsetClassMetadata(c,[{type:e.NgModule,args:[{declarations:[h],imports:[],exports:[h]}]}],null,null),t.MyLibComponent=h,t.MyLibModule=c,t.MyLibService=a,t.parseBool=function(t){return"ON"==t?1:"OFF"==t?0:-1},Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=my-lib.umd.min.js.map